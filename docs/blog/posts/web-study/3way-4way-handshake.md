---
draft: false
authors:
  - hyewon
date: 2024-01-06
categories:
  - Web
---

# TCP/UDPμ™€ 3 -Way Handshake & 4 -Way Handshake

> TCPμ 3-Way Handshake μ™€ 4-Way Handshakeμ— λ€ν•΄ μ•μ•„λ³΄κΈ° μ „μ— μ „μ†΅(Transport) ν”„λ΅ν† μ½μΈ TCPμ™€ UDPμ— λ€ν•΄ μ•μ•„λ³΄μ

<!-- more -->

## TCPμ™€ UDP

- OSI 7κ³„μΈµ μ¤‘ 4κ³„μΈµ(μ „μ†΅)μ΄λ‹¤.
- TCP: "μ„Έκ·Έλ¨ΌνΈ"
- UDP: "λ°μ΄ν„°κ·Έλ¨"

---

### π TCP (Transmission Control Protocol)

- μΈν„°λ„·μƒμ—μ„ λ°μ΄ν„°λ¥Ό λ©”μ„Έμ§€μ ν•νƒλ΅ λ³΄λ‚΄κΈ° μ„ν•΄ IPμ™€ ν•¨κ» μ‚¬μ©ν•λ” ν”„λ΅ν† μ½
- TCPλ” μ• ν”λ¦¬μΌ€μ΄μ…μ—κ² μ‹ λΆ°μ μ΄κ³  μ—°κ²°μ§€ν–¥μ„± μ„λΉ„μ¤ μ κ³µ
- μΌλ°μ μΌλ΅ TCPμ™€ IPλ” ν•¨κ» μ‚¬μ©λλ©° IPλ” λ°°λ‹¬μ„, TCPλ” ν¨ν‚·μ μ¶”μ  λ° κ΄€λ¦¬
- TCPλ” μ—°κ²°ν• μ„λΉ„μ¤λ΅, μ‹ λΆ°μ μΈ μ „μ†΅μ„ λ³΄μ¥ν•κΈ°μ— hanshakingν•κ³  λ°μ΄ν„°μ νλ¦„μ μ–΄μ™€ νΌμ΅μ μ–΄λ¥Ό μν–‰
  - 3-way handshakingκ³Όμ •μ„ ν†µν•΄ μ—°κ²°μ„ μ„¤μ •ν•κ³  4-way handshakingμ„ ν†µν•΄ ν•΄μ 
- μ†λ„κ°€ λλ¦Ό

---

### π UDP (User Datagram Protocol)

- λ°μ΄ν„°λ¥Ό λ°μ΄ν„°κ·Έλ¨ λ‹¨μ„λ΅ μ²λ¦¬ν•λ” ν”„λ΅ν† μ½
  - λ°μ΄ν„°κ·Έλ¨ : λ…λ¦½μ μΈ κ΄€κ³„λ¥Ό μ§€λ‹λ” ν¨ν‚·
- λΉ„μ—°κ²°ν• ν”„λ΅ν† μ½
  - ν• λ‹Ήλλ” λ…Όλ¦¬μ μΈ κ²½λ΅κ°€ μ—†κ³  κ°κ°μ λ°μ΄ν„°(ν¨ν‚·)λ¥Ό μ„λ΅ λ‹¤λ¥Έ κ²½λ΅λ΅ λ…λ¦½ μ²λ¦¬ν•λ” ν”„λ΅ν† μ½
- μ—°κ²°μ„ μ„¤μ •ν•κ³  ν•΄μ ν•λ” κ³Όμ •μ΄ μ΅΄μ¬ν•μ§€ μ•λ”λ‹¤. μ„λ΅ λ‹¤λ¥Έ κ²½λ΅λ΅ λ…λ¦½μ μΌλ΅ μ²λ¦¬ν•¨μ—λ„ ν¨ν‚·μ— μμ„λ¥Ό λ¶€μ—¬ν•μ—¬ μ¬μ΅°λ¦½ν•κ±°λ‚ νλ¦„μ μ–΄ λ° νΌμ΅μ μ–΄λ¥Ό μν–‰ν•μ§€ μ•λ”λ‹¤.
- μ‹ λΆ°μ„±μ΄ λ‚®λ‹¤
- TCPλ³΄λ‹¤ μ†λ„κ°€ λΉ λ¥΄λ‹¤

---

### π TCPμ™€ UDPμ μ°¨μ΄μ 

> μ‹ λΆ°λ€? λ°μ΄ν„°λ¥Ό μμ‹ ν•λ” μ…μ¥μ—μ„ μƒκ°ν•κΈ°!  
> -> μ „λ‹¬ λ°›μ€ λ°μ΄ν„°κ°€ μ™„λ²½ν•μ§€ μ•μ•„λ„ λλ” κ²½μ°(μμƒν†µν™”) β†’ UDP μ‚¬μ©

| TCP (Transmission Control Protocol)                                             | UDP (User Datagram Protocol) |
| ------------------------------------------------------------------------------- | ---------------------------- |
| μ—°κ²° μ§€ν–¥μ  ν”„λ΅ν† μ½                                                            | λΉ„μ—°κ²° μ§€ν–¥μ  ν”„λ΅ν† μ½       |
| λ†’μ€ μ‹ λΆ°μ„± (λ°μ΄ν„° ν¨ν‚·μ μ†μ‹¤, μμ„ λ°”λ€, μ¤‘λ³µ λ“±μ„ κ°μ§€ν•κ³  μμ •), λλ¦° μ†λ„ | λΉ λ¥Έ μ „μ†΅, λ‚®μ€ μ‹ λΆ°μ„±       |
| handshake κ³Όμ •μ„ ν†µν• μ—°κ²°                                                      | Unicasting                   |
| νΉμ • μ•„μ΄ν”Όλ¥Ό μ§€μ •ν•μ—¬ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•λ” μ λ‹μΊμ¤ν…                             | Broadcasting                 |
| μμ‹  μ—¬λ¶€ ν™•μΈ                                                                  | μμ‹  μ—¬λ¶€ ν™•μΈ x             |

## 3-Way Handshakeμ™€ 4-Way Handshake

> 3-Way Handshake λ” TCPμ μ ‘μ†, 4-Way Handshakeλ” TCPμ μ ‘μ† ν•΄μ  κ³Όμ •μ΄λ‹¤.

### π ν”λκ·Έ μ •λ³΄

- SYN(Synchronize Sequence Number) / 000010
  - μ—°κ²° μ„¤μ •. Sequence Numberλ¥Ό λλ¤μΌλ΅ μ„¤μ •ν•μ—¬ μ„Έμ…μ„ μ—°κ²°ν•λ” λ° μ‚¬μ©ν•λ©°, μ΄κΈ°μ— Sequence Numberλ¥Ό μ „μ†΅ν•λ‹¤.
- ACK(Acknowledgement) / 010000
  - μ‘λ‹µ ν™•μΈ. ν¨ν‚·μ„ λ°›μ•λ‹¤λ” κ²ƒμ„ μλ―Έν•λ‹¤.
- FIN(Finish) / 000001
  - μ—°κ²° ν•΄μ . μ„Έμ… μ—°κ²°μ„ μΆ…λ£μ‹ν‚¬ λ• μ‚¬μ©λλ©°, λ” μ΄μƒ μ „μ†΅ν•  λ°μ΄ν„°κ°€ μ—†μμ„ μλ―Έν•λ‹¤.

<br>
<br>

### π 3-Way handshake

3-Way handshakeλ”TCP/IP ν”„λ΅ν† μ½λ΅ ν†µμ‹ ν•κΈ° μ „ μ •ν™•ν• μ •λ³΄ μ „μ†΅μ„ μ„ν•΄ μƒλ€λ°© μ»΄ν“¨ν„°κ³Ό μ„Έμ…μ„ μ—°κ²°/μλ¦½ ν•λ” κ³Όμ • (=TCP μ—°κ²° μ΄κΈ°ν™”)

<br>

> 3-way handshakeμ μ‘λ™ λ°©μ‹

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² μ ‘μ†μ„ μ”μ²­ν•λ” SYNμ‹ νΈμ„ λ³΄λ‚Έλ‹¤.
2. μ„λ²„λ” μ”μ²­μ„ μλ½ν•λ” ACKλ¥Ό ν¬ν•¨ν•μ—¬ SYN+ACKμ‹ νΈλ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ°μ†΅ν•λ‹¤.
3. ν΄λΌμ΄μ–ΈνΈκ°€ μ΄κ²ƒμ„ μμ‹ ν• ν›„ λ‹¤μ‹ ACKλ¥Ό μ„λ²„μ—κ² λ°μ†΅ν•λ©΄ μ—°κ²°μ΄ μ΄λ£¨μ–΄μ§€κ³ , μ΄λ΅μ¨ λ°μ΄ν„°λ¥Ό μ£Όκ³ λ°›μ„ μ μκ² λλ‹¤.

```mermaid
sequenceDiagram
    participant Client
    participant Server

    Client->>Server: 1. SYN: μ—°κ²°ν•΄μ¤
    note right of Server: μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ <br/> μ—°κ²° μ”μ²­μ„ λ°›μ
    Server->>Client: 2. SYN + ACK
    note left of Client: μ„λ²„: μ”μ²­ λ°›μ•μ–΄(ACK) <br/> λ‚λ„ μ—°κ²°ν•΄μ¤(SYN)
    Client->>Server: 3. ACK
    note right of Server: ν΄λΌμ΄μ–ΈνΈ: μ”μ²­ ν™•μΈν–μ–΄
```

---

### π 4-Way handshake

3-Way handshakeλ¥Ό ν†µν•΄ Connection Setupμ„ ν–λ‹¤λ©΄, TCPμ—°κ²°μ„ μΆ…λ£ν•λ” Connection Termination κ³Όμ •μ€ 4-Way handshakeλ¥Ό ν†µν•΄ μ΄λ£¨μ–΄μ§‘λ‹

<br>

> 4-way handshakeμ μ‘λ™ λ°©μ‹

1. Client μ—μ„ Process μΆ…λ£ν•  λ–„ FIN μ‹ νΈλ¥Ό λ³΄λ‚Έλ‹¤.
2. Serverλ” FIN μ‹ νΈλ¥Ό λ°›μ•λ‹¤λ” μ‘λ‹µμ— λ€ν• ACKλ¥Ό Clientλ΅ λ³΄λƒ…λ‹λ‹¤. λ‹¨, μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ λ°μ΄ν„° μ „μ†΅μ΄ μ™„λ£κ°€ μ•„μ§ μ• λ μƒνƒμΌ μ μμµλ‹λ‹¤.
3. μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ λ¨λ“  λ°μ΄ν„° μ „μ†΅μ΄ μ™„λ£λ λ‹¤μ, FIN μ‹ νΈλ¥Ό ν΄λΌμ΄μ–ΈνΈλ΅ λ³΄λƒ…λ‹λ‹¤.
4. μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° ACKλ¥Ό λ°›μΌλ©΄ TCP μ—°κ²°μ΄ μΆ…λ£λ©λ‹λ‹¤.

```mermaid
sequenceDiagram
    participant ν΄λΌμ΄μ–ΈνΈ
    participant μ„λ²„

    ν΄λΌμ΄μ–ΈνΈ->>μ„λ²„: 1. FIN: λ‚΄κ°€ λ³΄λ‚Ό κ±΄ λ‹¤ λ³΄λƒμ–΄, μ—°κ²° λμ
    μ„λ²„->>ν΄λΌμ΄μ–ΈνΈ: 2. ACK: μ•κ² μ–΄, λ‚¨μ€ ν¨ν‚· λ³΄λ‚΄μ¤„κ²
    Note over μ„λ²„: μ„λ²„κ°€ λ‚¨μ€ λ°μ΄ν„°λ¥Ό μ „μ†΅ μ™„λ£
    μ„λ²„->>ν΄λΌμ΄μ–ΈνΈ: 3. FIN: λ‚λ„ λ³΄λ‚Ό κ±° λ‹¤ λ³΄λƒμ–΄, μ΄μ  λλ‚΄μ
    ν΄λΌμ΄μ–ΈνΈ->>μ„λ²„: 4. ACK: μ•κ² μ–΄
    Note over ν΄λΌμ΄μ–ΈνΈ,μ„λ²„: TCP μ—°κ²° μΆ…λ£ μ™„λ£

```
### π TIME_WAIT

- ν΄λΌμ΄μ–ΈνΈλ” TIME_WAIT μƒνƒκ°€ λκ³  μ„λ²„λ΅ ACKλ¥Ό λ³΄λ‚΄λ©΄ μ„λ²„κ°€ CLOSEDμƒνƒκ°€ λλ‹¤.
- μ†μΌ“μ΄ λ°”λ΅ μ†λ©Έλμ§€ μ•κ³  μΌμ • μ‹κ°„ μ μ§€λλ” μƒνƒ
    - μ°λ¶„ν¬(60μ΄), μλ„μ°(4λ¶„)
- μΌμ •μ‹κ°„ λ’¤μ— λ‹«λ” μ΄μ ?
    - μ§€μ—°λλ” ν¨ν‚·μ΄ λ°μƒν•μ—¬ λ°μ΄ν„° λ¬΄κ²°μ„±(λ°μ΄ν„°μ μ •ν™•μ„±κ³Ό μΌκ΄€μ„± λ³΄μ¥) λ¬Έμ λ¥Ό λ°©μ§€ν•κΈ° μ„ν•¨μ΄λ‹¤.

### π ν΄λΌμ΄μ–ΈνΈκ°€ λ§μ§€λ§‰μ— ACKλ¥Ό κµ³μ΄ λ³΄λ‚΄λ” μ΄μ λ”?
ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„λ΅λ¶€ν„° FIN ν¨ν‚·μ„ λ°›κ³ , μ΄μ— λ€ν• ν™•μΈ μ‘λ‹µμΌλ΅ ACKμ„ λ³΄λ‚΄λ©΄μ„ λ„¤νΈμ›ν¬ ν†µμ‹ μ μ‹ λΆ°μ„±μ„ μ μ§€ν•  μ μκ³ , ν΄λΌμ΄μ–ΈνΈκ°€ FIN ν¨ν‚·μ„ μ„±κ³µμ μΌλ΅ λ°›μ•λ‹¤λ” κ²ƒμ„ μ„λ²„κ°€ ν™•μΈν•  μ μμ–΄ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ λ¨λ‘ μ—°κ²°μ΄ μ„±κ³µμ μΌλ΅ μΆ…λ£λμ—λ‹¤λ” κ²ƒμ„ μ• μ μλ‹¤.

<br>
<br>
<br>
<br>
