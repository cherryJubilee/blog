---
draft: false
authors:
    - hyewon
date: 2024-08-27
categories:
    - spring
---

# AJAX

-   Javascript Object Notation (자바스크립트 객체 표기법)
-   JSON.stringify(), JSON.parse()

<!-- more -->

## JSON

### JSON 배열

-   [ {}, {}, {} ]처럼 객체의 배열로 표현

    ```json
    [
        {
            "속성명": "속성값",
            "속성명": "속성값",
            "속성명": "속성값",
            "속성명": "속성값"
        },
        {
            "속성명": "속성값",
            "속성명": "속성값",
            "속성명": "속성값",
            "hobby": "속성값"
        }
    ]
    ```

### JSON 객체

-   { "key1": {}, "key2": {} }처럼 키-값 쌍으로 표현

    ```json
    {
        "키1": {
            "속성명1": "속성값1",
            "속성명2": "속성값2",
            "속성명3": "속성값3",
            "속성명4": "속성값4"
        },
        "키2": {
            "속성명1": "속성값1",
            "속성명2": "속성값2",
            "속성명3": "속성값3",
            "hobby": "속성값"
        }
    }
    ```

## ✔️ JSON.stringify(), JSON.parse()

-   client side에서의 이야기이다.
-   `JSON.stringify()`
    -   JS 객체를 서버로 전달하기 위해서 직렬화(문자열로 변환)가 필요
    -   객체를
    -   {name : 홍길동, age : 30} -> "{"name" : "홍길동", "age" : "30"}"
-   ## `JSON.parse()`
    -   서버가 보낸 데이터(JSON 문자열)을 JS 객체로 변환이 필요. 역직렬화
    -   {name : 홍길동, age : 30} <- "{"name" : "홍길동", "age" : "30"}"
    -   서버로부터 데이터를

## ✔️ jackson-databind

-   server side에서의 이야기
-   json문자열로 자바에서 받아서 사용할 수 있도록 JAVA 객체로 변환해주는 기능
-   JAVA 컨트롤러가 이를 받을 수 있다.

## AJAX

### Jquery를 이용한 AJAX

```ajax
$.ajax({
    type: post 또는 get,
    ascync : "true" or "false",
    url: "요청할 URL",
    data: {서버로 보낼 데이터},
    dataType : "text 서버에서 전송받을 데이터 형식",
    success: {
        // 정상 요청, 응답 시 처리
    },
    error : {
        // 오류 발생시 처리
    } ,
    complete : {
        // 작업 완료 후 처리
    }
```

## 관련 어노테이션( @RequestBody, @Controller)

### @RequestBody

-   HTTP Request Message Body 를 통해 전달된 데이터를 지정한 객체로 deserialize
    -   JSON 형태의 데이터를 파라미터로 전달하고 싶을 때 사용

### @Controller

-   View를 반환하기 위해 사용됨
-   @RequestBody 어노테이션 활용
    -   Data를 반환할 때 사용 (JSON)
    -   반환되는 객체가 JSON으로 serialized 되어 반환됨

### @RestController

-   @RequestBody + @Controller
-   주목적은 JSON 형태의 데이터를 반환하는 것

## AJAX 요청과 응답 과정

![alt text](image.png)

```java
@Controller
public class SimpleRestController {

	@GetMapping("/ajax")
	public String  ajax() {
		return "ajax";
	}

	@ResponseBody
	@PostMapping("/send")
		public Person test(@RequestBody Person p) {
			System.out.println("p = " +  p);
			p.setName("kosta 0902");
			p.setAge(38);
			return p;
		}
	}

```

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>


<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="<c:url value='/resources/css/menu.css' />" />
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css" />
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<title>Insert title here</title>
</head>
<body>
	<h2>{name : "kosta", age : 31}</h2>
	<button id="sentBtn" type="button">SEND</button>

	<h2>Data from server</h2>
	<div id="data"></div>

	<script type="text/javascript">
	$(document).ready(function) {
		let person = {name : "kosta", age : 28}
		let person2 = {}
		$("#sendBtn").click(function() {

			$ajax({
				type : "POST",
				url : '/october/send',
				headers: {"Content-Type": "application/json"},
				data: JSON.stringify(person),
				dataType : "text",
				success: function(result) {
			        person2 = JSON.parse(result);
			        alert("received: " + result);
			        $("#data").html("name = " + person2.name + " age = " + person2.age);
			    },
			    error: function() {
			        alert("error");
			    }
			})

			alert("this request is sent")
		})
	}
	</script>
</body>
</html>
```
