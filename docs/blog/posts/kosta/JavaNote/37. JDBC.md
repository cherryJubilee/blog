---
draft: false
authors:
    - hyewon
date: 2024-07-17
categories:
    - java
    - db
---

# JDBC

> ë°ì´í„°ë² ì´ìŠ¤ì™€ í†µì‹ í•˜ëŠ” ë°©ë²•, íŠ¸ëœì ì…˜(transaction) ì²˜ë¦¬

<!-- more -->

## ğŸ“Œ JDBC (Java Database Connectivity)

1. ìë°”ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ìë°” API(ì¸í„°í˜ì´ìŠ¤)
2. JDBC êµ¬ì¡°
   ![](../JavaNote/JavaImage/image.png)

3. java.sql íŒ¨í‚¤ì§€ ì œê³µ
    - ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ì‹œìŠ¤í…œ(DBMS)ì˜ ì¢…ë¥˜ì™€ ìƒê´€ì—†ì´ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í´ë˜ìŠ¤ì™€ ì¸í„°í˜ì´ìŠ¤ë¡œ êµ¬ì„±ë¨

## ğŸ“Œ DB ì—°ê²°

1.  í•´ë‹¹ DBMSì˜ JDBC Driverê°€ í•„ìš”í•¨
    ![](../JavaNote/JavaImage/image2.png)
2.  JDBC Driver ì¤€ë¹„(ì„¤ì¹˜)
    -   https://mvnrepository.com/artifact/com.mysql/mysql-connector-j/9.0.0
    -   jaríŒŒì¼ ë‹¤ìš´ë¡œë“œ í›„ í”„ë¡œì íŠ¸ bin í´ë” ì•ˆì— ìœ„ì¹˜ì‹œí‚¤ê¸°
        ![](../JavaNote/JavaImage/image3.png)
3.  JDBC Driverë¥¼ ë©”ëª¨ë¦¬ë¡œ í• ë‹¹

    -   DriverManagerì— JDBC Driver ê°ì²´ë¥¼ ë“±ë¡í•˜ê²Œ ë¨
        ![](../JavaNote/JavaImage/image4.png)

    ```java
    Class.forName("com.mysql.cj.jdbc.Driver");
    ```

4.  getConnection() ë©”ì„œë“œë¡œ DBì™€ ì—°ê²°

    ```java
    Connection conn = DriverManager.getConnection("url", "ì‚¬ìš©ì", "ë¹„ë°€ë²ˆí˜¸");
    // ì˜ˆì‹œ
    String url = "jdbc:mysql://localhost:3306/jdbc(DBëª…)";
    ```

## ğŸ“Œ ë°ì´í„° ì €ì¥

1. ë§¤ê°œë³€ìˆ˜í™”ëœ INSERTë¬¸ìœ¼ë¡œ ë³€ê²½

    - ê°’ì„ ?(ë¬¼ìŒí‘œ)ë¡œ ëŒ€ì²´í•œ ë§¤ê°œë³€ìˆ˜í™”ëœ INSERTë¬¸ìœ¼ë¡œ ë³€ê²½í•¨

    ```sql
    INSERT INTO jdbc.users
    (userid, username, userpassword, userage, useremail)
    VALUES(?, ?, ?, ?, ?);
    ```

2. PreparedStatement ê°ì²´ ìƒì„±

    - ë§¤ê°œë³€ìˆ˜í™”ëœ SQLë¬¸ ì‹¤í–‰í•˜ë ¤ë©´ PreparedStatementê°€ í•„ìš”í•¨

    ```java
    PreparedStatement pstmt = conn.prepareStatement(sql);
    ```

3. ?ì— ë“¤ì–´ê°ˆ ê°’ ì§€ì •

    - ?ëŠ” ìˆœì„œì— ë”°ë¼ 1ë²ˆë¶€í„° ë²ˆí˜¸ê°€ ë¶€ì—¬ë¨
        - ê°’ì˜ íƒ€ì…ì— ë”°ë¼ Setter ë©”ì†Œë“œ ì„ íƒ
        - ì²«ë²ˆì§¸ì—ëŠ” ìˆœë²ˆ, ë‘ë²ˆì§¸ì—ëŠ” ê°’ ì§€ì •í•¨

    ```java
    pstmt.setString(1,"kosta2");
    pstmt.setString(2,"ì½”ìŠ¤íƒ€2");
    pstmt.setString(3,"pass123#");
    pstmt.setInt(4,30);
    pstmt.setString(5,"kosta2@kosta.com");
    ```

4. executeUpdate() ë©”ì„œë“œ í˜¸ì¶œ

    - sqlë¬¸ ì‹¤í–‰
    - ë¦¬í„´í•˜ëŠ” ê°’ì€ ì €ì¥ëœ í–‰ì˜ ìˆ˜
        - í…Œì´ë¸” 1ê°œ í–‰ ì €ì¥ë¨
        - ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆì„ ê²½ìš° 1 ë¦¬í„´ë¨

    ```java
    int rowsInserted = pstmt.executeUpdate();
    ```

5. PreparedStatement ê°ì²´ë¥¼ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•Šì„ ê²½ìš° close() ë©”ì„œë“œ í˜¸ì¶œ

    - ì‚¬ìš©í–ˆë˜ ë©”ëª¨ë¦¬ í•´ì œ

    ```java
    pstmt.close();
    ```

6. JDBC í‘œì¤€ ì¸í„°í˜ì´ìŠ¤

    - 3ê°€ì§€ ê¸°ëŠ¥ì„ ì¸í„°í˜ì´ìŠ¤ë¡œ ì •ì˜í•˜ì—¬ ì œê³µ
        - Connection (ì—°ê²°)
        - Statement (SQL ì „ë‹¬)
        - ResultSet (ê²°ê³¼ ì‘ë‹µ)

### ğŸ€ ë°ì´í„° ì €ì¥ ì˜ˆì‹œ (INSERT)

<details>
<summary> í…Œì´ë¸”ì— INSERT ì˜ˆì‹œ </summary>

```java
package kr.co.kosta.mysql;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class UserInsertTest {
    public static void main(String[] args) {
        Connection conn = null;
        try {
            // JDBC Drvier ë“±ë¡
            Class.forName("com.mysql.cj.jdbc.Driver");

            //  ì—°ê²°í•˜ê¸°
            conn = DriverManager.getConnection(
              "jdbc:mysql://127.0.0.1:3306",
              "root",
              "pass123#"
            );
            String sql = ""+
                    "insert into jdbc.users (userid, username, userpassword, userage, useremail) "+
                    "VALUES(?,?,?,?,?);";
            // PreparedStatement ê°ì²´ ì–»ê¸°(ìƒì„±)
            PreparedStatement pstmt = conn.prepareStatement(sql);
            // ê°’ ì§€ì •
            pstmt.setString(1,"kosta2");
            pstmt.setString(2,"ì½”ìŠ¤íƒ€2");
            pstmt.setString(3,"pass123#");
            pstmt.setInt(4,30);
            pstmt.setString(5,"kosta2@kosta.com");

            // SQLë¬¸ ì‹¤í–‰
            int rows=pstmt.executeUpdate();
            System.out.println("ì €ì¥ëœ í–‰ ìˆ˜ : "+rows);
            //  PreparedStatement ë‹«ê¸°
            pstmt.close();

        }catch (ClassNotFoundException | SQLException e){
            throw new RuntimeException(e);
        }finally {
            if(conn !=null){
                // ì—°ê²°ëŠê¸°
                try {
                    conn.close();
                    System.out.println("ì—°ê²° ëŠê¸°");
                } catch (SQLException e) {
                    throw new RuntimeException(e);
                }
            }
        }
    }
}
```

</<details>

## ğŸ“Œ ë°ì´í„° ìˆ˜ì •

```sql
UPDATE boards
SET btitle='ë¹„ì˜¤ëŠ” ìˆ˜ìš”ì¼', bcontent='ì¥ë§ˆê°€ ì´ì œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤', bwriter='kosta1', bfilename='event2.png'
WHERE bid=1;
```

### ğŸ€ ë°ì´í„° ì €ì¥ ì˜ˆì‹œ (UPDATE)

<details>
<summary> í…Œì´ë¸” UPDATE ì˜ˆì‹œ </summary>

```java
package kr.co.kosta.mysql;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class BoardUpdateTest {
    public static void main(String[] args) {
        Connection conn=null;
        try {
        // JDBC Drvier ë“±ë¡
            Class.forName("com.mysql.cj.jdbc.Driver");

            conn= DriverManager.getConnection(
                    "jdbc:mysql://127.0.0.1:3306",
                    "kosta",
                    "pass123#"
            );
            String sql= new StringBuilder()
                    .append("UPDATE jdbc.boards SET ")
                    .append("btitle=?, ")
                    .append("bcontent= ?, ")
                    .append("bwriter=?, ")
                    .append("bfilename= ? " )
                    .append("WhERE bid=?")
                    .toString();
            // PreparedStatement ê°ì²´ ì–»ê¸°(ìƒì„±)
            PreparedStatement pstmt =conn.prepareStatement(sql);
            pstmt.setString(1,"ë¹„ ê·¸ì¹œ ì˜¤í›„");
            pstmt.setString(2,"ë¹„êµ¬ë¦„ì´ ì§€ê¸ˆì€ ìœ„ë¡œ ì˜®ê²¼ìŠµë‹ˆë‹¤.");
            pstmt.setString(3,"kosta1");
            pstmt.setString(4,"event.png");
            pstmt.setInt(5,1);

            // SQLë¬¸ ì‹¤í–‰
            int rows =pstmt.executeUpdate();
            System.out.println("ìˆ˜ì •ëœ í–‰ ìˆ˜ : "+rows);
            // PreparedStatement close
            pstmt.close();

        }catch (ClassNotFoundException | SQLException e){
            throw  new RuntimeException(e);
        }finally {
            if(conn !=null){
                // ì—°ê²°ëŠê¸°
                try {
                    conn.close();
                    System.out.println("ì—°ê²° ëŠê¸°");
                } catch (SQLException e) {
                    throw new RuntimeException(e);
                }
            }
        }
    }
}

```

## ğŸ“Œ ë°ì´í„° ì‚­ì œ

### ğŸ€ ë°ì´í„° ì‚­ì œ ì˜ˆì‹œ (DELETE)

<details>
<summary> í…Œì´ë¸” DELETE ì˜ˆì‹œ </summary>

```java
package kr.co.kosta.mysql;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class BoardUpdateTest {
    public static void main(String[] args) {
        Connection conn=null;
        try {
        // JDBC Drvier ë“±ë¡
            Class.forName("com.mysql.cj.jdbc.Driver");

            conn= DriverManager.getConnection(
                    "jdbc:mysql://127.0.0.1:3306",
                    "kosta",
                    "pass123#"
            );
            String sql= new StringBuilder()
                    .append("UPDATE jdbc.boards SET ")
                    .append("btitle=?, ")
                    .append("bcontent= ?, ")
                    .append("bwriter=?, ")
                    .append("bfilename= ? " )
                    .append("WhERE bid=?")
                    .toString();
            // PreparedStatement ê°ì²´ ì–»ê¸°(ìƒì„±)
            PreparedStatement pstmt =conn.prepareStatement(sql);
            pstmt.setString(1,"ë¹„ ê·¸ì¹œ ì˜¤í›„");
            pstmt.setString(2,"ë¹„êµ¬ë¦„ì´ ì§€ê¸ˆì€ ìœ„ë¡œ ì˜®ê²¼ìŠµë‹ˆë‹¤.");
            pstmt.setString(3,"kosta1");
            pstmt.setString(4,"event.png");
            pstmt.setInt(5,1);

            // SQLë¬¸ ì‹¤í–‰
            int rows =pstmt.executeUpdate();
            System.out.println("ìˆ˜ì •ëœ í–‰ ìˆ˜ : "+rows);
            // PreparedStatement close
            pstmt.close();

        }catch (ClassNotFoundException | SQLException e){
            throw  new RuntimeException(e);
        }finally {
            if(conn !=null){
                // ì—°ê²°ëŠê¸°
                try {
                    conn.close();
                    System.out.println("ì—°ê²° ëŠê¸°");
                } catch (SQLException e) {
                    throw new RuntimeException(e);
                }
            }
        }
    }
}

```

## ğŸ“Œ ë°ì´í„° ì¡°íšŒ(ì½ê¸°)

```sql
SELECT * FROM boards
WHERE bwriter='kosta1';
```

### ResultSet

-   select ë¬¸ì— ê¸°ìˆ ëœ ì»¬ëŸ¼ìœ¼ë¡œ êµ¬ì„±ëœ í–‰ì˜ ì§‘í•©(row)
-   ì»¤ì„œê°€ ìˆëŠ” í–‰ì˜ ë°ì´í„°ë§Œ ì½ì„ ìˆ˜ ìˆìŒ
-   ì»¤ì„œ : í–‰ì„ ê°€ë¥´í‚¤ëŠ” í¬ì¸í„°ë¥¼ ë§í•¨
-   ì‹¤ì œ ê°€ì ¸ì˜¨ ë°ì´í„° í–‰ì˜ ì•ê³¼ ë’¤ì— beforeFirst()í–‰ê³¼ afterLast()í–‰ì„ ê°€ë¥´í‚´
-   ì²«ë²ˆ ì§¸ ë°ì´í„° í–‰ì¸ firstí–‰ì„ ì½ìœ¼ë ¤ë©´ ì»¤ì„œë¥¼ ì´ë™ì‹œì¼œì•¼ í•¨
-   next() ë©”ì†Œë“œ ì‚¬ìš©

|  ë°ì´í„° í–‰   |     ë‚ ì§œ      |      ë‚´ìš©      |   ì»¤ì„œ ìœ„ì¹˜   |
| :----------: | :-----------: | :------------: | :-----------: |
| ìµœì´ˆì»¤ì„œìœ„ì¹˜ |               |                | beforeFirst() |
|      4       | ë¹„ì˜¤ëŠ” ìˆ˜ìš”ì¼ | ì¥ë§ˆê°€ ì‹œì‘ë¨1 |    first()    |
|      5       | ë¹„ì˜¤ëŠ” ëª©ìš”ì¼ | ì¥ë§ˆê°€ ì‹œì‘ë¨2 |               |
|      6       | ë¹„ì˜¤ëŠ” ê¸ˆìš”ì¼ | ì¥ë§ˆê°€ ì‹œì‘ë¨3 |    next()     |
|      7       | ë¹„ì˜¤ëŠ” í† ìš”ì¼ | ì¥ë§ˆê°€ ì‹œì‘ë¨4 |               |
|      8       | ë¹„ì˜¤ëŠ” ì¼ìš”ì¼ | ì¥ë§ˆê°€ ì‹œì‘ë¨5 |    last()     |
|              |               |                |  afterLast()  |

### boolean next()

    -   ì´ë™í•œ í–‰ì— ë°ì´í„°ê°€ ìˆìœ¼ë©´ trueë¥¼ ì—†ìœ¼ë©´ falseë¥¼ ë¦¬í„´í•¨

## ğŸ’¡ query

<details>
<summary>[query9.sql] JDBC ì‹¤ìŠµí•  ë•Œ ì‚¬ìš©í•œ ì¿¼ë¦¬ </summary>

```sql
drop table users;
create table users (
	userid		varchar(50)		primary key,
    username	varchar(50)		not null,
    userpassword	varchar(50)	not null,
    userage		numeric(3)		not null,
    useremail	varchar(50)		not null
);

drop table boards;
create table boards (
	bid			int				primary key	auto_increment,
    btitle		varchar(100)	not null,
    bcontent	longtext		not null,
    bwriter		varchar(50)		not null,
    bdate		datetime		default now(),
    bfilename	varchar(50)		null,
    bfiledata	longblob		null
);

drop table accounts;
create table accounts (
	aid			varchar(20)		primary key,
    owner		varchar(20)		not null,
    balance		numeric			not null
);


INSERT INTO jdbc.users (userid, username, userpassword, userage, useremail)
VALUES('kosta1', 'ì½”ìŠ¤íƒ€1', 'pass123#', 25, 'kosta1@kosta.com');


INSERT INTO jdbc.boards
(btitle, bcontent, bwriter, bdate, bfilename)
VALUES('ë¹„ì˜¤ëŠ” ìˆ˜ìš”ì¼', 'ì¥ë§ˆê°€ ì´ì œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'kosta1', now(), 'event.png');


UPDATE jdbc.boards
SET btitle='ë¹„ì˜¤ëŠ” ìˆ˜ìš”ì¼', bcontent='ì¥ë§ˆê°€ ì´ì œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤', bwriter='kosta1', bfilename='event2.png'
WHERE bid=1;

DELETE FROM jdbc.boards
WHERE bid=1;

DELETE FROM jdbc.boards WHERE bwriter='kosta1';
```

</details>

## ğŸ“Œ íŠ¸ëœì ì…˜(transaction)

1. ê¸°ëŠ¥ì²˜ë¦¬ì˜ ìµœì†Œ ë‹¨ìœ„
    - ì†Œì‘ì—…ë“¤ì„ ë¶„ë¦¬í•  ìˆ˜ ì—†ìŒ
    - ì „ì²´ë¥¼ í•˜ë‚˜ë¡œ ë³¸ë‹¤.
2. í•˜ë‚˜ì˜ ê¸°ëŠ¥ì€ ì—¬ëŸ¬ ê°€ì§€ ì†Œì‘ì—…ë“¤ë¡œ êµ¬ì„±ë  ìˆ˜ ìˆìŒ
3. íŠ¸ëœì ì…˜ì€ ì†Œì‘ì—…ë“¤ì´ ëª¨ë‘ ì„±ê³µí•˜ê±°ë‚˜ ëª¨ë‘ ì‹¤íŒ¨í•´ì•¼í•¨
    - ì»¤ë°‹(commit)
        - DMLë¬¸(SELECT, INSERT, UPDATE, DELETE)ì„ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ ìë™ ì»¤ë°‹ì´ ë˜ê³  ìˆì—ˆìŒ
    - ì½œë°±(rollback)
4. ê³„ì¢Œì´ì²´
    - ì¶œê¸ˆ ì‘ì—…, ì…ê¸ˆ ì‘ì—…ìœ¼ë¡œ êµ¬ì„±ëœ íŠ¸ëœì­ì…˜ì„
    - ì¶œê¸ˆê³¼ ì…ê¸ˆ ì‘ì—… ì¤‘ í•˜ë‚˜ë§Œ ì„±ê³µí•  ìˆ˜ ì—†ìŒ
    - ëª¨ë‘ ì„±ê³µí•˜ê±°ë‚˜ ëª¨ë‘ ì‹¤íŒ¨ë˜ì–´ì•¼ í•¨

## ğŸ“Œ ê²Œì‹œíŒ ë§Œë“¤ê¸°

> JDBCë¥¼ í™œìš©í•œ ê²Œì‹œíŒ êµ¬í˜„í•˜ê¸°

```java

```
