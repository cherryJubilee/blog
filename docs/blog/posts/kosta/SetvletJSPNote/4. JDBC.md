---
draft: false
authors:
    - hyewon
date: 2024-07-24
categories:
    - Backend
---

# JDBC

JDBC ì—°ê²°í•˜ëŠ” 3ê°€ì§€ ë°©ë²•

1. ê¸°ë³¸ ìƒì„±ì
2. ì™¸ë¶€ ë§¤ê°œë³€ìˆ˜ë¥¼ í†µí•œ ìƒì„±ì ì˜¤ë²„ë¡œë”©
3. ServletContextë¥¼ ì‚¬ìš©í•œ ìƒì„±ì ì˜¤ë²„ë¡œë”© â­ï¸

JDNIë¥¼ ì´ìš©í•œ ë°ì´í„°ë² ì´ìŠ¤ Connection Pool ê´€ë¦¬

-   context.xml, server.xml ì„¤ì •

<!-- more -->

## ğŸ“Œ JDBC ì—°ê²°

-   https://dev.mysql.com/downloads/connector/j/
-   platform Independent ì„ íƒ
-   zipìœ¼ë¡œ ëœ jar íŒŒì¼ ë‹¤ìš´!
    -   ![](img/image6.png)
-   ì••ì¶• í’€ì–´ì„œ ì´í´ë¦½ìŠ¤ lib í´ë” ì•„ë˜ì— ë„£ì–´ì£¼ê¸°

### ğŸ€ JDBC ì—°ê²° 3ê°€ì§€ ë°©ë²•

1. ê¸°ë³¸ ìƒì„±ì
    - í´ë˜ìŠ¤ ë‚´ë¶€ì— í•˜ë“œì½”ë”©ëœ DB ì—°ê²° ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°
2. ìƒì„±ì ì˜¤ë²„ë¡œë”©1
    - ìƒì„±ìë¥¼ í†µí•´ ì™¸ë¶€ì—ì„œ ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬ëœ DB ì—°ê²° ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°
3. ìƒì„±ì ì˜¤ë²„ë¡œë”©
    - ServletContextë¥¼ í†µí•œ ì„¤ì • ê°’ ì‚¬ìš© : `ServletContext`ì—ì„œ ì´ˆê¸°í™” ë§¤ê°œë³€ìˆ˜ë¥¼ ê°€ì ¸ì™€ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•©ë‹ˆë‹¤. ì´ëŠ” ì„¤ì •ì„ web.xmlì— ë‘ê³ , ì½”ë“œì—ì„œ ì´ë¥¼ ì½ì–´ì˜¤ëŠ” ë°©ì‹
    - ì„¤ì •ì •ë³´ë¥¼ ì½”ë“œì™€ ë¶„ë¦¬í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì™€ ê´€ë¦¬ê°€ ìš©ì´í•¨

<details>
<summary>JDBC ì—°ê²° 3ê°€ì§€ ì½”ë“œ ì˜ˆì œ</summary>

```java
package kr.co.kosta.jdbc;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import jakarta.servlet.ServletContext;

public class JDBCConnectTest {
	public Connection con;
	public Statement stmt;
	public PreparedStatement pstmt;
	public ResultSet rs;

	// ê¸°ë³¸ ìƒì„±ì
	public JDBCConnectTest() {
		try {
			// Driver Load
			Class.forName("com.mysql.cj.jdbc.Driver");

			// DB ì—°ê²°
			String url = "jdbc:mysql://localhost:3306/teampro";
			String id = "root";
			String pwd = "pass123#";

			con = DriverManager.getConnection(url, id, pwd);

			System.out.println("DB ì—°ê²° ì„±ê³µ(ê¸°ë³¸ ìƒì„±ì)");

		} catch (ClassNotFoundException | SQLException e) {
			e.printStackTrace();
		}
	}

	// ìƒì„±ì ì˜¤ë²„ë¡œë”©1
    public JDBCConnectTest(String driver, String url, String id, String pwd) {
        try {
             // ë“œë¼ì´ë²„ ë¡œë“œ
            Class.forName("com.mysql.cj.jdbc.Driver");
            // DB ì—°ê²°
            con = DriverManager.getConnection(url, id, pwd);
            System.out.println("DB ì—°ê²° ì„±ê³µ(ìƒì„±ì ì˜¤ë²„ë¡œë”©1)");

        } catch (ClassNotFoundException | SQLException e) {
            e.printStackTrace();
        }
    }

	// ìƒì„±ì ì˜¤ë²„ë¡œë”© 2
	public JDBCConnectTest(ServletContext application) {

		String driver = application.getInitParameter("MySQLDriver");

		try {
			// ë“œë¼ì´ë¸Œ ë¡œë“œ
			Class.forName(driver);
			// DB ì—°ê²°
			String url = application.getInitParameter("MySQLURL");
			String id = application.getInitParameter("MySQLId");
			String pwd = application.getInitParameter("MySQLPwd");

			con = DriverManager.getConnection(url, id, pwd);
			System.out.println("DB ì—°ê²° ì„±ê³µ( ìƒì„±ì ì˜¤ë²„ë¡œë”© 2)");

		} catch (ClassNotFoundException  | SQLException e) {
			e.printStackTrace();
		}

	}

	//	ì—°ê²° í•´ì œ ë° ìì› ë°˜ë‚©
	public void close() {
		if (con != null)
			try {
				con.close();
				System.out.println("JDBC ìì› í•´ì œ");

			} catch (SQLException e) {
				e.printStackTrace();
			}
	}
}

```

```jsp
<%@page import="kr.co.kosta.jdbc.DBConnectionPoolTest"%>
<%@page import="kr.co.kosta.jdbc.JDBCConnectTest"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>JDBC test1</title>
</head>

<body>
	<h2>JDBC í…ŒìŠ¤íŠ¸ 1</h2>
	<%
	JDBCConnectTest jdbc1 = new JDBCConnectTest();
	jdbc1.close();
	%>

	<h2>JDBC í…ŒìŠ¤íŠ¸2: ìƒì„±ì ì˜¤ë²„ë¡œë”© 1</h2>
	<%
	String driver = application.getInitParameter("MySQLDriver");
	//-> getInitParameterì— ë“¤ì–´ê°€ëŠ” íŒŒë¼ë¯¸í„°ê°’ì€ web.xmlì—ì„œ ì–»ì–´ì˜¤ëŠ” param-nameê°’
	String url = application.getInitParameter("MySQLURL");
	String id = application.getInitParameter("MySQLId");
	String pwd = application.getInitParameter("MySQLPwd");

	JDBCConnectTest jdbc2 = new JDBCConnectTest(driver, url, id, pwd);
	jdbc2.close();
	%>

	<h2>JDBC í…ŒìŠ¤íŠ¸3 : ìƒì„±ì ì˜¤ë²„ë¡œë”© 2</h2>
	<%
	JDBCConnectTest jdbc3 = new JDBCConnectTest(application);
	jdbc3.close();
	%>

</body>
</html>
```

âœ”ï¸ web.xml : ì´ˆê¸°í™” ë§¤ê°œë³€ìˆ˜ ì‘ì„± -> ìƒì„±ì ì˜¤ë²„ë¡œë”©2 ì˜ˆì œë¥¼ ìœ„í•´ì„œ

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="https://jakarta.ee/xml/ns/jakartaee"
	xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_6_0.xsd"
	id="WebApp_ID" version="6.0">
	<display-name>JDBCJSP</display-name>
	<welcome-file-list>
		<welcome-file>index.html</welcome-file>
		<welcome-file>index.jsp</welcome-file>
		<welcome-file>index.htm</welcome-file>
		<welcome-file>default.html</welcome-file>
		<welcome-file>default.jsp</welcome-file>
		<welcome-file>default.htm</welcome-file>
	</welcome-file-list>
	<context-param>
		<param-name>MySQLDriver</param-name>
		<param-value>com.mysql.cj.jdbc.Driver</param-value>
	</context-param>
	<context-param>
		<param-name>MySQLURL</param-name>
		<param-value>jdbc:mysql://localhost:3306/teampro</param-value>
	</context-param>
	<context-param>
		<param-name>MySQLId</param-name>
		<param-value>root</param-value>
	</context-param>
	<context-param>
		<param-name>MySQLPwd</param-name>
		<param-value>pass123#</param-value>
	</context-param>
</web-app>
```

</details>

## ğŸ“Œ ì»¤ë„¥ì…˜ í’€ (Connection Pool)

1.  ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë  ë•Œ, ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ë¯¸ë¦¬ ìƒì„±í•´ë‘ë©´, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ í•„ìš”í•  ë•Œë§ˆë‹¤ ì¤€ë¹„ëœ ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ì‚¬ìš©
2.  ![alt text](img/image8.png)
3.  JNDI

    -   WASê°€ ì œê³µí•˜ëŠ” ì»¤ë„¥ì…˜ì„ ì´ìš©í•¨
    -   Java Naming and Directory Interface
        -   ì´ë¦„ë§Œìœ¼ë¡œ ì°¾ì•„ ì“¸ ìˆ˜ìˆëŠ” ë””ë ‰í† ë¦¬ ì„œë¹„ìŠ¤
    -   ìš°ë¦¬ê°€ ì—°ê²°í•˜ê³  ì‹¶ì€ ë°ì´í„°ë² ì´ìŠ¤ì˜ DB Poolì„ ë¯¸ë¦¬ Naming ì‹œì¼œì£¼ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ì´ë‹¤. ìš°ë¦¬ê°€ ì €ì¥í•´ë†“ì€ WAS ì˜ ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´ì— JNDIë¥¼ ì„¤ì •í•´ ë†“ìœ¼ë©´ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ JNDIë§Œ í˜¸ì¶œí•˜ë©´ ê°„ë‹¨í•´ì§„ë‹¤.

### ğŸ€ JNDI ì˜ˆì œ (JDBCJSPí”„ë¡œì íŠ¸)

> server.xml

-   Resource ì¶”ê°€

![](img/image7.png)

```xml
<GlobalNamingResources>
    <!-- Editable user database that can also be used by
        UserDatabaseRealm to authenticate users
    -->
    <Resource auth="Container" description="User database that can be updated and saved" factory="org.apache.catalina.users.MemoryUserDatabaseFactory" name="UserDatabase" pathname="conf/tomcat-users.xml" type="org.apache.catalina.UserDatabase"/>
    <Resource
        auth = "Container"
        driverClassName = "com.mysql.cj.jdbc.Driver"
        type = "javax.sql.DataSource"
        initialSize = "0"
        minIdle = "5"
        minTotal = "20"
        maxIdle = "20"
        maxWaitMillis = "5000"
        url = "jdbc:mysql://localhost:3306/teampro?serverTimezone=UTC"
        name = "dbcp_mysql"
        username = "root"
        password = "pass123#"
        />
</GlobalNamingResources>
```

> context.xml

```xml
<ResourceLink
    global="dbcp_mysql"
    name = "dbcp_mysql"
    type = "javax.sql.DataSource"
/>
```

> DBConnectionPoolTest.java

```java
package kr.co.kosta.jdbc;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.NamingException;
import javax.sql.DataSource;

public class DBConnectionPoolTest {

	public Connection con;
	public Statement stmt;
	public PreparedStatement pstmt;
	public ResultSet rs;

	public DBConnectionPoolTest() {

		try {
			// DataSource(Connection Pool) ê°ì²´ ì–»ê¸°
			Context context = new InitialContext();
			Context ctx = (Context) context.lookup("java:comp/env");
			DataSource dataSource = (DataSource) ctx.lookup("dbcp_mysql");

			// ì»¤ë„¥ì…˜ í’€ì„ í†µí•´ì„œ ì—°ê²° ê°ì²´ ì–»ê¸°
			con = dataSource.getConnection();

			System.out.println("DBì—°ê²° ì„±ê³µ ( ì»¤ë„¥ì…˜ í’€ )");

		} catch (NamingException | SQLException e) {
			System.out.println("DBì—°ê²° ì‹¤íŒ¨  ( ì»¤ë„¥ì…˜ í’€ )");
			e.printStackTrace();
		}

	}

	//	ì—°ê²° í•´ì œ ë° ìì› ë°˜ë‚©
	public void close() {
		if (con != null)
			try {
				con.close();
				System.out.println("ì»¤ë„¥ì…˜ í’€ ìì› í•´ì œ");

			} catch (SQLException e) {
				e.printStackTrace();
			}
	}
}
```
